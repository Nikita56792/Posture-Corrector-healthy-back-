# Корректор Осанки — программно-аппаратный комплекс  

> **Корректор Осанки** — проект, который сочетает носимую электронику, электромиостимуляцию, искусственный интеллект и голосового робота-ассистента, чтобы формировать полезную привычку держать спину ровно и предупреждать заболевания опорно-двигательного аппарата.

---

## Содержание
1. [Обзор возможностей](#обзор-возможностей)  
2. [Аппаратные компоненты](#аппаратные-компоненты)  
3. [Программные подсистемы](#программные-подсистемы)  
4. [Быстрый старт](#быстрый-старт)  
5. [Сетевое взаимодействие](#сетевое-взаимодействие)  
6. [Настройка и калибровка](#настройка-и-калибровка)  

---

## Обзор возможностей
| Модуль | Ключевые функции |
|--------|------------------|
| **Планка-датчик** | IMU-отслеживание углов позвоночника, барометрия, вибро-обратная связь, автономная работа 24 ч |
| **EMS-стимулятор** | 8 режимов миостимуляции (20-100 Гц, 2-10 мА), динамическая адаптация под пользователя |
| **Мини-робот** | Голосовые подсказки (TTS), распознавание команд (STT), мотивационная анимация |
| **Мобильное приложение** | Настройка параметров, статистика, GigaChat-ассистент, OTA-обновления ПО |
| **ПК-ПО** | Анализ осанки через веб-камеру (OpenCV + MediaPipe), экспорт данных, UDP шлюз |

---

## Аппаратные компоненты
| Поз.| Деталь | Кол-во | Примечание |
|----|---------|-------|-----------|
| 1 | ESP8266 (Wemos D1 mini) | 1 | основной MCU планки |
| 2 | MPU-6050 + BMP-280 | 1 | IMU + барометр |
| 3 | Вибромотор 3 V | 1 | тактильный сигнал |
| 4 | Аксессуар-«петля» | 1 | крепление на шею |
| 5 | Li-ion аккумулятор 500 mAh | 1 | 20 ч работы |
| 6 | DRV2605L | 1 | драйвер EMS-канала |
| 7 | Raspberry Pi Zero 2 W | 1 | мозг голосового робота |

Полная разводка планки находится в `docs/hardware/pcb.pdf`, 3D-модель — в `cad/flatback.step`.

---

## Программные подсистемы
| Подсистема | Язык / Стек | Описание |
|------------|-------------|----------|
| **Firmware (планка)** | C++ / Arduino Core | Wi-Fi STA / AP, UDP автопоиск, REST-конфигуратор, нейросетевой фильтр TensorFlow Lite |
| **EMS-контроллер** | C++ / FreeRTOS | ШИМ-генератор импульсов, безопасное ограждение по току |
| **Voice Bot** | Python 3.11 | `speech_recognition`, `pyttsx3`, `gigachat-sdk`, ROS-мастер для сервоприводов |
| **ПК-клиент** | Python 3.x | `opencv-python`, `mediapipe`, Flask-сервер `/get_posture` |
| **Мобильное приложение** | Unity 2022 (C#) | UDP сканер, WebSocket-мост, локальная БД SQLite, UI Toolkit |
| **Облако** | FastAPI + PostgreSQL | Хранение телеметрии, генерация отчётов, cron-задачи обучения |

---

## Быстрый старт
### 1. Подготовка планки
```bash
cd firmware/esp8266
pio run -t upload           # platformio
pio device monitor          # убедитесь, что порт 1234 открыт
```

### 2. Запуск ПК-приложения
```bash
python pc_app/main.py       # откроет окно с видеопотоком и отправит UDP-кадры
```

### 3. Привязка в мобильном клиенте  
1. Нажмите **«Поиск устройства»** – приложение само найдёт планку в подсети и отправит тест-пакет `242`.  
2. После ответа сигнатурой `123985` сохранится IP-адрес и станет доступна настройка EMS.

### 4. Первичная калибровка  
*В мобильном приложении* → **Настройки → Калибровать** – планка запишет текущий угол как «ноль» и подтвердит JSON-командой:  
```json
{ "status": "ok", "gyroZ0": -4.5 }
```

---

## Сетевое взаимодействие
| Канал | Протокол | Назначение |
|-------|----------|------------|
| Планка ↔ смартфон | UDP, 1234 порт | обмен телеметрией и командой `SET:P,M` |
| Планка ↔ смартфон | HTTP / REST | веб-страница конфигуратора `<ip>/` |
| ПК-клиент → смартфон | WebSocket 8080 | поток углов позвоночника в JSON |
| Смартфон ↔ облако | HTTPS / MQTT | бэкап данных, синхронизация профиля |

---

## Настройка и калибровка
| Операция | Где выполняется | Команда / UI |
|----------|----------------|--------------|
| Сброс Wi-Fi | Кнопка **Reset Wi-Fi** в конфиг-странице планки | `/reboot_without_save` |
| Смена AP/STA | Мобильное → **Сеть Wi-Fi** | `/modeAP` / `/modeSTA` |
| Аппаратная калибровка IMU | Кнопка **Калибровать** | UDP `567` |
| Проверка связи | Auto-пинг каждые 5 с | UDP `PING` / `PONG` |

---

> **Будьте здоровы и держите спину прямо!**
